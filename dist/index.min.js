"use strict";var __assign=this&&this.__assign||function(){return(__assign=Object.assign||function(t){for(var n,o=1,e=arguments.length;o<e;o++)for(var r in n=arguments[o])Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r]);return t}).apply(this,arguments)},__awaiter=this&&this.__awaiter||function(t,n,o,e){return new(o||(o=Promise))((function(r,a){function i(t){try{u(e.next(t))}catch(t){a(t)}}function s(t){try{u(e.throw(t))}catch(t){a(t)}}function u(t){var n;t.done?r(t.value):(n=t.value,n instanceof o?n:new o((function(t){t(n)}))).then(i,s)}u((e=e.apply(t,n||[])).next())}))},__generator=this&&this.__generator||function(t,n){var o,e,r,a,i={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(o)throw new TypeError("Generator is already executing.");for(;i;)try{if(o=1,e&&(r=2&a[0]?e.return:a[0]?e.throw||((r=e.return)&&r.call(e),0):e.next)&&!(r=r.call(e,a[1])).done)return r;switch(e=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,e=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(r=i.trys,(r=r.length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){i.label=a[1];break}if(6===a[0]&&i.label<r[1]){i.label=r[1],r=a;break}if(r&&i.label<r[2]){i.label=r[2],i.ops.push(a);break}r[2]&&i.ops.pop(),i.trys.pop();continue}a=n.call(t,i)}catch(t){a=[6,t],e=0}finally{o=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.Hooks=void 0;var Hooks=function(){function t(){this.onAjax=[],this.onInit=[]}return t.prototype.addInitHook=function(t){return this.addHook("onInit",t)},t.prototype.addAjaxHook=function(t){return this.addHook("onAjax",t)},t.prototype.addHook=function(t,n){switch(t){case"onAjax":return this.onAjax.push(n),n;case"onInit":return this.onInit.push(n),n;default:return this[t]instanceof Array?(Array.prototype.push.call(this[t],n),n):null}},t}();exports.Hooks=Hooks;var hooks=new Hooks,axette={init:init,run:onAjax,hooks:hooks,on:onHook,onInit:onInitHook,onAjax:onAjaxHook,fixURL:noFlashURL};function init(t){void 0===t&&(t="ajax");var n=document.querySelectorAll("a."+t);n&&n.forEach((function(t){t.addEventListener("click",(function(t){t.preventDefault(),axette.run(t.target.href)}))}));var o=document.querySelectorAll("form."+t);o&&o.forEach((function(t){t instanceof HTMLFormElement&&t.addEventListener("submit",(function(n){n.preventDefault();var o=new FormData(t),e=new URLSearchParams(String(o)).toString();"post"===t.method.toLowerCase()?axette.run(t.action,e,"application/x-www-form-urlencoded").catch((function(t){})):axette.run(t.action+"?"+e).catch((function(t){}))}))})),axette.hooks.onInit.forEach((function(t){t.fn instanceof Function&&t.fn.apply(t,t.args)}))}function onAjax(t,n,o){return void 0===n&&(n=null),void 0===o&&(o="application/json"),__awaiter(this,void 0,void 0,(function(){var e,r,a,i,s;return __generator(this,(function(u){switch(u.label){case 0:return[4,fetch(t,__assign({method:n?"POST":"GET",headers:__assign({"X-Requested-With":"XMLHttpRequest"},n&&{"Content-Type":o})},n&&{body:n}))];case 1:return[4,u.sent().json()];case 2:return e=u.sent(),r=e.snippets,a=void 0===r?{}:r,i=e.redirect,""!==(s=void 0===i?"":i)&&window.location.replace(s),Object.entries(a).forEach((function(t){var n=t[0],o=t[1],e=document.getElementById(n);e&&(e.innerHTML=o)})),axette.hooks.onAjax.forEach((function(t){t.fn instanceof Function&&t.fn.apply(t,t.args)})),axette.init(),[2]}}))}))}function noFlashURL(){var t=window.location.toString(),n=t.indexOf("_fid=");if(-1!==n){var o=t.substr(0,n)+t.substr(n+10);"?"!==o.substr(o.length-1)&&"&"!==o.substr(o.length-1)||(o=o.substr(0,o.length-1)),window.history.replaceState("",document.title,o)}}function onAjaxHook(t){for(var n=[],o=1;o<arguments.length;o++)n[o-1]=arguments[o];axette.on("onAjax",t,n)}function onInitHook(t){for(var n=[],o=1;o<arguments.length;o++)n[o-1]=arguments[o];axette.on("onInit",t,n)}function onHook(t,n){for(var o=[],e=2;e<arguments.length;e++)o[e-2]=arguments[e];return axette.hooks.addHook(t,{fn:n,args:o})}exports.default=axette;